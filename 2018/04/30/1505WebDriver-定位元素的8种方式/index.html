<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">



<title>WebDriver-定位元素的8种方式 | 张卫宁的技术博客</title>



    <link rel="icon" href="/cat.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">weining&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/E-BOOK">E-BOOK</a>
                
                    <a class="menu-item" href="http://deceptivestarry.gitee.io/finddata">Search</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>

        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">weining&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                    <a class="menu-item" href="/E-BOOK">E-BOOK</a>
                
                    <a class="menu-item" href="http://deceptivestarry.gitee.io/finddata">Search</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">WebDriver-定位元素的8种方式</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Wenng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">April 30, 2018&nbsp;&nbsp;15:38:30</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/爬虫/">爬虫</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <img src="/2018/04/30/1505WebDriver-定位元素的8种方式/u=2933934959,1210900580&fm=26&gp=0.jpg">

<h1 id="WebDriver–定位元素的8种方式"><a href="#WebDriver–定位元素的8种方式" class="headerlink" title="WebDriver–定位元素的8种方式"></a>WebDriver–定位元素的8种方式</h1><p>在UI层面的自动化测试开发中，元素的定位与操作是基础，也是经常遇到的困难所在。webdriver提供了8种定位：</p>
<h2 id="id定位："><a href="#id定位：" class="headerlink" title="id定位："></a>id定位：</h2><p>find_element_by_id(“id值”)；id属性是唯一的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_id(<span class="string">"loginName"</span>).clear()<span class="comment">#用户名输入框的id属性</span></span><br><span class="line">driver.find_element_by_id(<span class="string">"loginName"</span>).send_keys(<span class="string">"admin"</span>)</span><br><span class="line">driver.find_element_by_id(<span class="string">"pwdTip"</span>).send_keys(Keys.TAB)<span class="comment">#密码输入框的id属性</span></span><br><span class="line">driver.find_element_by_id(<span class="string">"pwdTip"</span>).send_keys(<span class="string">"111111"</span>)</span><br></pre></td></tr></table></figure>

<h2 id="name定位："><a href="#name定位：" class="headerlink" title="name定位："></a>name定位：</h2><p>元素的名称，<code>find_element_by_name(&quot;name值&quot;)</code>；<code>name</code>属性值在当前页面可以不唯一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 driver.find_elements_by_name(&quot;PeriodName&quot;)[1].click()#选择学段：初中</span><br><span class="line">2 driver.find_elements_by_name(&quot;SubjectName&quot;)[0].click()#选择学科：语文</span><br></pre></td></tr></table></figure>

<p>  <code>find_elements_by_name(&quot;PeriodName&quot;)</code>是因为当前页面有一组radiobutton的name值是PeriodName，所以可以用定位一组元素的方法findElements，定位出来的是结果一个list</p>
<h2 id="class定位："><a href="#class定位：" class="headerlink" title="class定位："></a>class定位：</h2><p>元素的类名，<code>find_element_by_class_name(&quot;class值&quot;)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_elements_by_class_name(&quot;u-btn-levred&quot;)[0].click()#选择年级：七年级</span><br></pre></td></tr></table></figure>

<h2 id="tag定位："><a href="#tag定位：" class="headerlink" title="tag定位："></a>tag定位：</h2><p>页面html文档下的各种标签，find_element_by_tag_name(“input”)；</p>
<p>tag往往用来定义一类功能，所以通过tag识别某个元素的概率很低。任意打开一个页面，都会发现大量的<code>&lt;div&gt;</code>、<code>&lt;input&gt;</code>、<code>&lt;a&gt;</code>等tag，所以tag name定位很少用</p>
<h2 id="link定位："><a href="#link定位：" class="headerlink" title="link定位："></a>link定位：</h2><p>专门用来定位文本链接，<code>find_element_by_link_name(&quot;text&quot;)；</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_link_text(u&quot;退出&quot;).click()#页面右上方的一些个人操作，比如退出、个人中心、消息通知等</span><br></pre></td></tr></table></figure>

<h2 id="partial-link定位："><a href="#partial-link定位：" class="headerlink" title="partial link定位："></a>partial link定位：</h2><p>是对link定位的一种补充，当链接上的文本内容比较长的时候，可以取文本的一部分进行定位，当然这部分可以唯一地标识这个链接</p>
<p>※注：以上的方式稍有局限，且经常页面没有id，name这些属性值，class name重复性较高，link定位有针对性，所以Xpath与Css定位更灵活些。</p>
<h2 id="XPath定位："><a href="#XPath定位：" class="headerlink" title="XPath定位："></a>XPath定位：</h2><p>find_element_by_xpath(“”)；有多种定位策略，用FirePath插件自动生成的涵盖以下几种方式</p>
<p>  1）绝对路径定位：对于没有id，name、classname不好定位的，这也是我最常用的，因为可以通过Firefox的FirePath插件可以方便的获取到xpath值</p>
<p>  2）利用元素属性定位：</p>
<p>　　find_element_by_xpath(“.//*[@id=’Title’]”)，这里是用的id，也可以用元素其他能够唯一标识的属性，不局限于id、name、class这些；<em>代表的是标签名，不指定时就可以用</em>代替</p>
<p>  3）层级与属性结合：下图中就是这种</p>
<p>  4）使用逻辑运算符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 driver.find_element_by_xpath(&quot;.//*[@id=&apos;divword&apos;]/input[7]&quot;).click()#登录</span><br><span class="line">2 driver.find_element_by_xpath(&quot;html/body/div[4]/div/div[2]/div/div[3]/a[1]&quot;).click()#个人页面的发布课程操作</span><br></pre></td></tr></table></figure>

<h2 id="CSS定位："><a href="#CSS定位：" class="headerlink" title="CSS定位："></a>CSS定位：</h2><p>（薄弱，用的很少，但很强大，比xpath简洁灵活）：使用选择器来为页面元素绑定属性，可以灵活地选择控件的任意属性；find_element_by_css_selector(“”)；同样也可以用FirePATH生成css哟！</p>
<p>  1）通过class属性定位：点号（”.”）表示通过class属性定位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;input class=&quot;u-btn mart5&quot; type=&quot;submit&quot; onclick=&quot;return User.check()&quot; value=&quot;登录&quot;&gt;</span><br><span class="line">2 driver.find_element_by_css_selector(&quot;.u-btn.mart5&quot;).click()</span><br></pre></td></tr></table></figure>

<p>  2）通过id属性定位：（”#”）表示通过id定位元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_css_selector(&quot;#loginName&quot;)</span><br></pre></td></tr></table></figure>

<p>  3）通过其他属性定位：（”[]”），中括号里的属性可以唯一标识这个元素就可以；属性的值可以加引号，也可以不加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 &lt;input class=&quot;u-btn mart5&quot; type=&quot;submit&quot; onclick=&quot;return User.check()&quot; value=&quot;登录&quot;&gt;</span><br><span class="line">2 driver.find_element_by_css_selector(&quot;[type=submit]&quot;).click()</span><br></pre></td></tr></table></figure>

<p>  4）组合定位</p>
<p>平时使用生成的xpath，id，name，classname这些比较多，今天根据最近这段时间的实践，并参照书上整理了下，发现原来XPath和Css下还有这么多方式，顺便拿最近一些代码试验了下，有些简单的css定位能够成功，有的Firepath生成的并不可用，一些组合定位还需要再研究，是有些难度的。最后记录一种定位方式，更接近底层实现方式的定位，But书上说webdriver更推荐前面那些写法，为毛捏？</p>
<h2 id="By定位元素："><a href="#By定位元素：" class="headerlink" title="By定位元素："></a>By定位元素：</h2><p>　　除find_element_by_***这种方式，还有另一套写法，也就是统一调用find_element()方法，两个参数，第一个参数是定位的类型，由By提供；第二个参数是定位的具体值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By     <span class="comment">#使用By这种定位前要将By类导入</span></span><br><span class="line"></span><br><span class="line">find_element(By.ID,<span class="string">"loginName"</span>)</span><br><span class="line">find_element(By.NAME,<span class="string">"SubjectName"</span>)</span><br><span class="line">find_element(By.CLASS_NAME,<span class="string">"u-btn-levred"</span>)</span><br><span class="line">find_element(By.TAG_NAME,<span class="string">"input"</span>)</span><br><span class="line">find_element(By.LINK_TEXT,<span class="string">"退出"</span>)</span><br><span class="line">find_element(By.PARTIAL_LINK_TEXT,<span class="string">"退"</span>)</span><br><span class="line">find_element(By.XPATH,<span class="string">".//*[@id='Title"</span>)</span><br><span class="line">find_element(By.CSS_SELECTOR,<span class="string">"[type=submit]"</span>)</span><br></pre></td></tr></table></figure>

<h1 id="python-webdriver学习笔记"><a href="#python-webdriver学习笔记" class="headerlink" title="python+webdriver学习笔记"></a>python+webdriver学习笔记</h1><h2 id="控制浏览器"><a href="#控制浏览器" class="headerlink" title="控制浏览器"></a>控制浏览器</h2><h3 id="设置浏览器大小：像素点"><a href="#设置浏览器大小：像素点" class="headerlink" title="设置浏览器大小：像素点"></a>设置浏览器大小：像素点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set_window_size(width,height)</span><br><span class="line"></span><br><span class="line">maximize_window() 浏览器全屏显示，不带参数</span><br></pre></td></tr></table></figure>

<h3 id="控制浏览器前进、后退："><a href="#控制浏览器前进、后退：" class="headerlink" title="控制浏览器前进、后退："></a>控制浏览器前进、后退：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver.forward()</span><br><span class="line"></span><br><span class="line">driver.back()</span><br></pre></td></tr></table></figure>

<h3 id="模拟浏览器刷新："><a href="#模拟浏览器刷新：" class="headerlink" title="模拟浏览器刷新："></a>模拟浏览器刷新：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.refresh()</span><br></pre></td></tr></table></figure>

<p>实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#参数是像素点宽，高  </span></span><br><span class="line">driver.set_window_size(<span class="number">800</span>,<span class="number">800</span>)  </span><br><span class="line">print(<span class="string">"浏览器大小是800px，800px"</span>)  </span><br><span class="line">  </span><br><span class="line">driver.find_element_by_link_text(<span class="string">"新闻"</span>).click()  </span><br><span class="line">driver.back()     <span class="comment">#返回前一个页面  </span></span><br><span class="line">driver.forward()  <span class="comment">#前进前一个页面  </span></span><br><span class="line">driver.refresh()  <span class="comment">#刷新当前页面  </span></span><br><span class="line">driver.find_element_by_css_selector(<span class="string">"#ww"</span>).send_keys(<span class="string">"python3"</span>)  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@class='btn']"</span>).click()  </span><br><span class="line">driver.refresh()  <span class="comment">#刷新当前页面  </span></span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>clear()清除文本</p>
<p>send_keys(“….”) 模拟按键输入</p>
<p>click() 单击元素，前提是它是可以被单击的对象。另外click()方法不仅可以用于单击一个按钮，它还能可以单击任何可以单击的文字、图片、checkbox、radio、select下拉框等。</p>
<p>submit() 用于提交表单，同样可以用于提交一个按钮。</p>
<h2 id="WebElement接口常用方法"><a href="#WebElement接口常用方法" class="headerlink" title="WebElement接口常用方法"></a>WebElement接口常用方法</h2><p>submit() 用于提交表单，同样可以用于提交一个按钮。</p>
<p>先看例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">size = driver.find_element_by_name(<span class="string">"wd"</span>).size  </span><br><span class="line">print(size)      <span class="comment">#size属性，返回元素的尺寸，表单输入框之类的width、height等  </span></span><br><span class="line">  </span><br><span class="line">text = driver.find_element_by_id(<span class="string">"jgwab"</span>).text  </span><br><span class="line">print(text)      <span class="comment">#text属性，获取元素的文本，可以用力判断打开的页面是否是预期的。  </span></span><br><span class="line">  </span><br><span class="line">attribute = driver.find_element_by_xpath(<span class="string">".//input[@id='kw']"</span>).get_attribute(<span class="string">'maxlength'</span>)  </span><br><span class="line">print(attribute) <span class="comment">#get_attribute()方法可以获取属性值  </span></span><br><span class="line">  </span><br><span class="line">result = driver.find_element_by_partial_link_text(<span class="string">"京公网安备"</span>).is_displayed()  </span><br><span class="line">print(result)   <span class="comment">#is_displayed() 元素是否设置可见，可见返回true则false  </span></span><br><span class="line">  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>size属性返回元素尺寸</p>
<p>text属性返回元素文本</p>
<p>get_attribute()方法获取属性值</p>
<p>is_displayed()方法返回该元素是否设置可见</p>
<h2 id="鼠标事件"><a href="#鼠标事件" class="headerlink" title="鼠标事件"></a>鼠标事件</h2><p>对鼠标的操作：右击、双击、悬停、鼠标拖动等功能，webdriver中对鼠标的操作的方法封装在ActionChains类中。</p>
<p>使用前要先导入ActionChains类：</p>
<p><strong>from selenium.webdriver.common.action_chains import ActionChains</strong></p>
<p>ActionChains类提供的鼠标操作常用方法：</p>
<ul>
<li>context_click()               右击</li>
<li>double_click()                双击</li>
<li>drag_and_drop()          拖动</li>
<li>move_to_element()     鼠标悬停</li>
<li>perform()                        执行所有ActionChains类中存储的行为，可以理解为对整个操作的提交动作</li>
</ul>
<h3 id="鼠标右键操作"><a href="#鼠标右键操作" class="headerlink" title="鼠标右键操作"></a>鼠标右键操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains  <span class="comment">#导入ActionChains类  </span></span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"https://yunpan.360.cn/"</span>)  </span><br><span class="line">driver.maximize_window ()  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@name='account']"</span>).clear()  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@name='account']"</span>).send_keys(<span class="string">"username.com"</span>)  </span><br><span class="line">driver.find_element_by_name(<span class="string">"password"</span>).clear()  </span><br><span class="line">driver.find_element_by_name(<span class="string">"password"</span>).send_keys(<span class="string">"pwd"</span>)  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='login']/div/div[2]/form/p[4]/label/input"</span>).click()  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='login']/div/div[2]/form/p[5]/input"</span>).click()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#定位到需要右击的元素  </span></span><br><span class="line">right_click = driver.find_element_by_link_text(<span class="string">"jemeter"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#对定位到的元素执行鼠标邮件操作，调用ActionChains类，将浏览器驱动driver作为参数传入，context_click()需要指定元素位置  </span></span><br><span class="line">ActionChains(driver).context_click(right_click).perform()</span><br></pre></td></tr></table></figure>

<h3 id="鼠标双击操作"><a href="#鼠标双击操作" class="headerlink" title="鼠标双击操作"></a>鼠标双击操作</h3><p>double_click()方法模拟鼠标双击操作</p>
<p>（单击查看详情，双击弹出修改页面就用这个方法模拟）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">  </span><br><span class="line">....  </span><br><span class="line"><span class="comment">#定位需要双击的元素  </span></span><br><span class="line">double_click = driver.find_element_by_xpath(<span class="string">""</span>)  </span><br><span class="line"><span class="comment">#对定位到的元素进行双击操作  </span></span><br><span class="line">ActionChains(driver).double_click(double_click).perform()  </span><br><span class="line">  </span><br><span class="line">a = driver.find_element_by_class_name(<span class="string">""</span>)  </span><br><span class="line">ActionChains(driver).double_click(a).perform()</span><br></pre></td></tr></table></figure>

<h3 id="鼠标悬停"><a href="#鼠标悬停" class="headerlink" title="鼠标悬停"></a>鼠标悬停</h3><p>move_to_element()方法模拟鼠标悬停</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">driver.set_window_size(<span class="number">1000</span>,<span class="number">1000</span>)  </span><br><span class="line"><span class="comment">#定位到悬停的元素  </span></span><br><span class="line">attrible = driver.find_element_by_link_text(<span class="string">"设置"</span>)  </span><br><span class="line"><span class="comment">#对定位到的元素进行悬停操作  </span></span><br><span class="line">ActionChains(driver).move_to_element(attrible).perform()  </span><br><span class="line">time.sleep(<span class="number">5</span>)  </span><br><span class="line">driver.refresh()</span><br></pre></td></tr></table></figure>

<p>以上3中鼠标操作用法相同！</p>
<h3 id="鼠标拖放操作"><a href="#鼠标拖放操作" class="headerlink" title="鼠标拖放操作"></a>鼠标拖放操作</h3><p>drag_and_drop(source,target) 在源元素上按住鼠标左键，然后移动到目标元素上释放。</p>
<ul>
<li>source 鼠标拖动的源元素</li>
<li>target鼠标释放的目标元素</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com/"</span>)  </span><br><span class="line"><span class="comment">#定位元素的初始位置  </span></span><br><span class="line">source = driver.find_element_by_css_selector(<span class="string">""</span>)  </span><br><span class="line"><span class="comment">#定位元素的要移动到的位置  </span></span><br><span class="line">target = driver.find_element_by_name(<span class="string">""</span>)  </span><br><span class="line"><span class="comment">#执行元素的拖放操作  </span></span><br><span class="line">ActionChains(driver).drag_and_drop(source,target).perform()</span><br></pre></td></tr></table></figure>

<h2 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h2><p>Keys()类提供了键盘上按键的方法，send_keys()方法可以用来模拟键盘输入，还可以用来输入键盘上的按键、组合键。</p>
<p>在使用键盘按键方法前需要先导入keys类：</p>
<p><strong>from selenium.webdriver.common.keys import  Keys</strong><br>实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">driver.maximize_window()  </span><br><span class="line">driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(<span class="string">"pythonm"</span>)  </span><br><span class="line"><span class="comment">#删除多输入的m  </span></span><br><span class="line">time.sleep(<span class="number">2</span>)                       <span class="comment">#删除键  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">'wd'</span>).send_keys(Keys.BACK_SPACE)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#输入空格键在输入“selenium”       #空格键  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(Keys.SPACE)  </span><br><span class="line">time.sleep(<span class="number">2</span>)  </span><br><span class="line">driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(<span class="string">"selenium"</span>)  </span><br><span class="line">time.sleep(<span class="number">2</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#ctrl+a全选输入框内容               #Ctrl+a全选  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(Keys.CONTROL,<span class="string">'a'</span>)  </span><br><span class="line">time.sleep(<span class="number">2</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#Ctrl+x剪切选中的内容               #Ctrl+x剪切  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(Keys.CONTROL,<span class="string">'x'</span>)  </span><br><span class="line">time.sleep(<span class="number">2</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#Ctrl+v粘贴选中的内容               #Ctrl+v粘贴  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">'wd'</span>).send_keys(Keys.CONTROL,<span class="string">'v'</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#通过输入enter键替代clic()单击      #enter回车键  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">'wd'</span>).send_keys(Keys.ENTER)  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<h2 id="获取验证信息"><a href="#获取验证信息" class="headerlink" title="获取验证信息"></a>获取验证信息</h2><p>在自动化用例执行之后，我们可以在页面上获取一些信息来证明，用例执行成功还是失败。</p>
<p>通常用到的验证信息分别是：text、title、URL</p>
<p>text：获取标签对之间的文本信息；<br>title：获取当前页面的标题；<br>current_url：获取当前页面的URL<br>它们是webdriver的属性！！！</p>
<p>实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://yunpan.360.cn"</span>)  </span><br><span class="line">  </span><br><span class="line">print(<span class="string">"登录之前："</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#打印打钱页面的title  </span></span><br><span class="line">title = driver.title  </span><br><span class="line">print(title)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#打印当前页面的URL  </span></span><br><span class="line">now_url = driver.current_url  </span><br><span class="line">print(now_url)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#获取“欢迎使用360云盘！”的文本  </span></span><br><span class="line">text = driver.find_element_by_tag_name(<span class="string">"h1"</span>).text  </span><br><span class="line">print(text)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#登录邮箱  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">"account"</span>).clear() <span class="comment">#name定位  </span></span><br><span class="line">driver.find_element_by_name(<span class="string">"account"</span>).send_keys(<span class="string">"xxxqq.com"</span>)  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@name='password']"</span>).clear() <span class="comment">#xpath元素属性定位  </span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@name='password']"</span>).send_keys(<span class="string">"yxxx36"</span>)  </span><br><span class="line"><span class="comment">#xpath元素属性和层级结合定位  </span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//div[@id='login']/div/div[2]/form/p[4]/label/input"</span>).click()  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='login']/div/div[2]/form/p[5]/input"</span>).click()  </span><br><span class="line">sleep(<span class="number">5</span>)  </span><br><span class="line">  </span><br><span class="line">print(<span class="string">"登录邮箱之后："</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#再次打印title  </span></span><br><span class="line">title = driver.title  </span><br><span class="line">print(title)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#打印当前的URL  </span></span><br><span class="line">now_url = driver.current_url  </span><br><span class="line">print(now_url)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#获取登录后的文本  </span></span><br><span class="line">text = driver.find_element_by_xpath(<span class="string">".//*[@id='crumb']/div/span"</span>).text  </span><br><span class="line">print(text)</span><br></pre></td></tr></table></figure>

<p>可以把登录之后的信息存放起来，作为验证登录是否成功。加断言就可可以。</p>
<h2 id="设置元素等待"><a href="#设置元素等待" class="headerlink" title="设置元素等待"></a>设置元素等待</h2><p>web应用程序采用AJAX技术时，页面上的元素不会同时被加载完成，防止定位元素会出现ElementNotVisibleException的错误，可以通过设置元素等待防止这种问题出现。</p>
<h3 id="显式等待"><a href="#显式等待" class="headerlink" title="显式等待"></a>显式等待</h3><p>显式等待使WebDriver等待某个条件成立时继续执行，否则在达到最大时长抛出超时异常（TimeException）。</p>
<p><strong>显式等待用到WebDriverWait()类和expected_conditions()类中的方法，使用前需要先导入：</strong></p>
<p><strong>from selenium.webdriver.support.ui import WebDriverWait</strong></p>
<p><strong>from selenium.webdriver.support import expected_conditions as EC</strong></p>
<p>显式等待相当于：在定位某个元素之前检查该元素是否被加载出来了，until到当前元素被加载到DOM树中</p>
<p>实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com//"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#显式等待  </span></span><br><span class="line"><span class="comment">#定位第一个元素  </span></span><br><span class="line">element = WebDriverWait(driver,<span class="number">5</span>,<span class="number">0.5</span>,ignored_exceptions=<span class="literal">None</span>).until(  </span><br><span class="line">    EC.presence_of_element_located((By.ID,<span class="string">"kw"</span>))  </span><br><span class="line">    )  </span><br><span class="line">element.send_keys(<span class="string">"ptyh"</span>)  </span><br><span class="line"><span class="comment">#定位第二个元素  </span></span><br><span class="line">element = WebDriverWait(driver,<span class="number">5</span>,<span class="number">0.5</span>,ignored_exceptions=<span class="literal">None</span>).until(  </span><br><span class="line">    EC.presence_of_element_located((By.ID,<span class="string">"su"</span>))  </span><br><span class="line">    )  </span><br><span class="line">element.click()  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>WebDriverWait(driver,timeout,poll_frequency=0.5,ignored_exceptions=None)</p>
<ul>
<li>driver：浏览器驱动</li>
<li>timeout：最长超时时间，默认单位是秒</li>
<li>poll_frequency：检测的间隔时间，默认是0.5秒</li>
<li>ignored_exceptions：超时后的异常信息，默认抛出NoSuchElementException异常。</li>
</ul>
<p>WebDriverWait()一般由until()或until_not()方法一起使用：</p>
<p>until(method,message = ‘xxx’)<br>until_not(method，message = ‘XXX’)</p>
<p>例子中until()的method是EC.presence_of_element_located((By.Id,”kw”)) </p>
<p>expected_conditions()类所提供的预期条件判断方法还很多！！<strong>P97</strong></p>
<p>除了预期类提供的判断外还可以用is_displayed()方法判断元素是否可见：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#利用is_displayed()方法判断元素是否可见  </span></span><br><span class="line"><span class="string">''''' </span></span><br><span class="line"><span class="string">for循环10次每次循环判断元素的is_diaplayed()状态 </span></span><br><span class="line"><span class="string">是否是true，若为true，则break跳出循环；否则sleep(1) </span></span><br><span class="line"><span class="string">后继续循环判断，知道10次循环结束后，打印“time_out”信息。 </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep,ctime  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">  </span><br><span class="line">print(ctime())  </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):  </span><br><span class="line">    <span class="keyword">try</span>:  </span><br><span class="line">        element = driver.find_element_by_id(<span class="string">"kw33"</span>)  </span><br><span class="line">        <span class="keyword">if</span> element.is_displayed():  </span><br><span class="line">            <span class="keyword">break</span>  </span><br><span class="line">    <span class="keyword">except</span>:<span class="keyword">pass</span>  </span><br><span class="line">    sleep(<span class="number">1</span>)  </span><br><span class="line"><span class="keyword">else</span>:  </span><br><span class="line">    print(<span class="string">"time_out!"</span>)  </span><br><span class="line">driver.close()  </span><br><span class="line">print(ctime())</span><br></pre></td></tr></table></figure>

<h3 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h3><p>隐式等待是通过一定的时长等待页面上某元素加载完成。如果超出了设置的时长元素还没有加载，会抛出NoSuchElementException异常。</p>
<p>webdriver的<strong>implicitly_wait()方法</strong>来实现隐式等待，默认设置为0。</p>
<p>隐式等待使用到抛出异常，NoSuchElementException异常需要先导入：</p>
<p><strong>from selenium .common.exceptions import NoSuchElementException</strong></p>
<p><strong>implicitly_wait()方法由webdriver提供。</strong></p>
<p>实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="comment">#from selenium.common.exceptions import NoSuchElementException  </span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#设置隐式等待是10s  </span></span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)  </span><br><span class="line">driver.get(<span class="string">"http://www.baidu.com/"</span>)  </span><br><span class="line"><span class="keyword">try</span>:  </span><br><span class="line">    print(ctime())  </span><br><span class="line">    driver.find_element_by_id(<span class="string">"kw22"</span>).send_keys(<span class="string">"python"</span>)  </span><br><span class="line"><span class="keyword">except</span> NoSuchElementException <span class="keyword">as</span> e:  </span><br><span class="line">    print(e)  </span><br><span class="line"><span class="keyword">finally</span>:  </span><br><span class="line">    print(ctime())  </span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>

<ul>
<li>implicitly_wait()默认参数单位是秒，这里的5秒并不是一个固定的等待时间，它不影响脚本的执行速度。</li>
<li>implicitly_wait()并不针对页面上的某一元素进行等待，当脚本执行到某个元素定位时，若元素可以定位，则继续执行；若元素定位不到，则它将以轮询的方式不断判断元素是否被定位到，直到超出设置时长还没有定位到元素，则抛出异常。</li>
</ul>
<h3 id="sleep休眠方法"><a href="#sleep休眠方法" class="headerlink" title="sleep休眠方法"></a>sleep休眠方法</h3><p>希望脚本执行到某个位置做固定休眠，可以使用sleep()方法。sleep()方法由<a href="http://lib.csdn.net/base/python" target="_blank" rel="noopener">Python</a>的time提供：</p>
<p><strong>from time import sleep</strong></p>
<p>实例：（结合隐式等待、键盘事件）</p>
<p><strong>隐式等待利用语句：try…except…else…finally…</strong></p>
<p>先对定位元素进行判断，若在设置的时间内定位元素失败就执行except语句抛出NoSuchElementException，定位到元素执行else语句代码继续执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep,ctime  </span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">print(ctime())  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#设置隐式等待  </span></span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#先执行try定位元素位置  </span></span><br><span class="line"><span class="keyword">try</span>:  </span><br><span class="line">    driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">    driver.maximize_window () <span class="comment">#全屏显示  </span></span><br><span class="line">    sleep(<span class="number">2</span>)  </span><br><span class="line">    el = driver.find_element_by_name(<span class="string">"wd"</span>)  </span><br><span class="line">    sleep(<span class="number">3</span>) <span class="comment">#休眠3秒  </span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#找不到元素位置就执行except      </span></span><br><span class="line"><span class="keyword">except</span> NoSuchElementException <span class="keyword">as</span> e:  </span><br><span class="line">    print(e)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#找到元素位置执行else语句  </span></span><br><span class="line"><span class="keyword">else</span>:  </span><br><span class="line">    el.send_keys(<span class="string">"pythonm"</span>)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">#删除多输入的m  </span></span><br><span class="line">    driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(Keys.BACK_SPACE)  </span><br><span class="line">    sleep(<span class="number">3</span>)  </span><br><span class="line">    <span class="comment">#输入空格+“自动化测试”  </span></span><br><span class="line">    driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(Keys.SPACE)  </span><br><span class="line">    sleep(<span class="number">3</span>)  </span><br><span class="line">    driver.find_element_by_name(<span class="string">"wd"</span>).send_keys(<span class="string">"自动化测试"</span>)  </span><br><span class="line">    sleep(<span class="number">3</span>)  </span><br><span class="line">    <span class="comment">#输入enter键百度一下  </span></span><br><span class="line">    driver.find_element_by_id(<span class="string">"su"</span>).send_keys(<span class="string">"Keys.ENTER"</span>)  </span><br><span class="line">    sleep(<span class="number">3</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#定不定位到元素都会执行finally语句  </span></span><br><span class="line"><span class="keyword">finally</span>:  </span><br><span class="line">    print(ctime())  </span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>

<h2 id="定位一组元素"><a href="#定位一组元素" class="headerlink" title="定位一组元素"></a>定位一组元素</h2><p><strong>webdriver提供了定位一组元素的方法：</strong></p>
<ul>
<li>find_elements_by_id()</li>
<li>find_elements_by_name()</li>
<li>find_elements_by_class_name()</li>
<li>find_elements_by_tag_name()</li>
<li>find_elements_by_xpath()</li>
<li>find_elements_by_css_selector()</li>
<li>find_elements_by_link_text()</li>
<li>find_elements_by_partial_link_text()</li>
</ul>
<p>原来定位一组元素和定位一个元素基本一样，唯一不同的是elements复数。</p>
<p>定位一组元素用于：</p>
<ul>
<li>批量操作元素，如勾选复选框checkbox、单选框radio。</li>
<li>先获取一组元素，再从这组元素对象中过滤出需要操作的元素，如定位页面所有的复选框，然后选择其中一个进行其他操作。</li>
</ul>
<p>如操作下面一段代码：checkbox.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"ch-zh"</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>checkbox test~<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span>  </span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">h2</span>&gt;</span>选择你喜欢的食物：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">id</span>=<span class="string">"myform"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"checkbox1"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span>苹果  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"checkbox2"</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span>栗子  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"checkbox3"</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span>西瓜  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"checkbox4"</span> <span class="attr">value</span>=<span class="string">"4"</span>&gt;</span>芒果  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"checkbox5"</span> <span class="attr">value</span>=<span class="string">"5"</span>&gt;</span>芒果  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">h2</span>&gt;</span>你是男士还是女士：<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"man"</span>&gt;</span>男士  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"woman"</span>&gt;</span>女士  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span>&gt;</span>  </span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">value</span>=<span class="string">"no"</span>&gt;</span>保密  </span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>把checkbox复选框全部选择：</p>
<p>find_elements_by_tag_name()定位，需要判断是否是checkbox</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">  </span><br><span class="line">driver.get(<span class="string">r"http://192.168.225.137/html5/checkbox.html"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#选择页面上所有tag_name是input的元素  </span></span><br><span class="line">inputs = driver.find_elements_by_tag_name(<span class="string">"input"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#然后过滤出type为checkbox的元素  </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> inputs:  <span class="comment">#用tag_name定位需要判断是否是checkbox，如下：  </span></span><br><span class="line">    <span class="keyword">if</span> i.get_attribute(<span class="string">"type"</span>) == <span class="string">"checkbox"</span>:  </span><br><span class="line">        i.click()  </span><br><span class="line">        time.sleep(<span class="number">1</span>)  </span><br><span class="line">inputs.pop().click()  </span><br><span class="line">inputs.pop().click(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>通过find_elements_by_xpath()和find_elements_by_css_selector()直接定位到checkbox：</p>
<p>不需要判断了，选择所有的复选框后取消第二个和最后一个：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://192.168.225.137/html5/checkbox.html"</span>)  </span><br><span class="line">driver.set_window_size(<span class="number">1000</span>,<span class="number">1000</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#通过css定位  </span></span><br><span class="line">checkboxs = driver.find_elements_by_css_selector(<span class="string">"[type='checkbox']"</span>)  </span><br><span class="line"><span class="comment">#通过xpath定位  </span></span><br><span class="line">inputs = driver.find_elements_by_xpath(<span class="string">"//*[@type='checkbox']"</span>)  </span><br><span class="line"><span class="comment">#通过以上两种方式定位就不需要判断定位的标签是否是复选框的了  </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> checkboxs:  </span><br><span class="line">    i.click()  </span><br><span class="line">    sleep(<span class="number">1</span>)  </span><br><span class="line">      </span><br><span class="line"><span class="comment">#打印当前页面上input="checkbox" 的个数  </span></span><br><span class="line">print(len(inputs))  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#把页面上第二个checkbox取到勾选  </span></span><br><span class="line">inputs.pop(<span class="number">1</span>).click()  </span><br><span class="line">sleep(<span class="number">2</span>)  </span><br><span class="line">driver.find_elements_by_xpath(<span class="string">"//*[@type='checkbox']"</span>).pop(<span class="number">-1</span>).click()  </span><br><span class="line"><span class="comment">#前面已经把所有checkbox勾上了，通过pop().click()对某个checkbox再勾选，即是取消勾选。</span></span><br></pre></td></tr></table></figure>

<ul>
<li>len()方法可以计算定位到的元素个数；</li>
<li>pop()方法获取列表中某个元素，pop().click()定位到某个checkbox后取消勾选；</li>
<li>pop()\pop(-1)都表示最后一个checkbox；</li>
<li>pop(0)第一个checkbox；</li>
</ul>
<h2 id="多表单切换"><a href="#多表单切换" class="headerlink" title="多表单切换"></a>多表单切换</h2><p>webdriver只能在一个页面上定位和识别元素，对于iframe或frame不能直接定位。</p>
<p>通过switch_to.frame()方法将当前的主体切换为frame或iframe表单的内嵌页面中。</p>
<p>myframe.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"ch-zn"</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">title</span>&gt;</span>myframe test!!!<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span>  </span><br><span class="line">    h3&#123;text-align:center;color:blue;&#125;  </span><br><span class="line">    div&#123;text-align:center;&#125;  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">style</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">h3</span>&gt;</span>myframe<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span>  </span><br><span class="line">     <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">"http://www.baidu.com/"</span> <span class="attr">width</span>=<span class="string">"800px"</span> <span class="attr">height</span>=<span class="string">"200px"</span> <span class="attr">name</span>=<span class="string">"myframe"</span> <span class="attr">id</span>=<span class="string">"if"</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2018/04/30/1505WebDriver-定位元素的8种方式/20161213223355248.jpg">

<p>如上内联框架，定位里面的百度页面元素时，先要使用switch_to.frame()找到<code>&lt;iframe&gt;</code>标签，然后再定位百度页面的元素。</p>
<p>实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep  </span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException  </span><br><span class="line">  </span><br><span class="line">driver =webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://192.168.225.137/html5/myframe.html"</span>)  </span><br><span class="line">driver.set_window_size(<span class="number">2000</span>,<span class="number">2000</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#切换到iframe里面，iframe（name='myframe'）  </span></span><br><span class="line">driver.switch_to.frame(<span class="string">"myframe"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#下面就是正常操作  </span></span><br><span class="line"><span class="comment">#隐式等待10s  </span></span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)  </span><br><span class="line"><span class="keyword">try</span>:  </span><br><span class="line">    el = driver.find_element_by_xpath(<span class="string">"//*[@id='kw']"</span>)  </span><br><span class="line">    el1 = driver.find_element_by_id(<span class="string">"su"</span>)  </span><br><span class="line">    sleep(<span class="number">2</span>)  </span><br><span class="line"><span class="keyword">except</span> NoSuchElementException <span class="keyword">as</span> e:  </span><br><span class="line">    print(e)  </span><br><span class="line"><span class="keyword">else</span>:  </span><br><span class="line">    el.send_keys(<span class="string">"python"</span>)  </span><br><span class="line">    el1.click()  </span><br><span class="line"><span class="keyword">finally</span>:  </span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>

<p>switch_to.frame()默认可以去id或name属性值定位，如果没有id或name属性，可以用下面方式定位：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime,sleep  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">  </span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)  </span><br><span class="line">print(ctime())  </span><br><span class="line">  </span><br><span class="line">driver.get(<span class="string">r"http://192.168.225.137/html5/myframe.html"</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#定位iframe的位置保存到变量el  </span></span><br><span class="line">el = driver.find_element_by_xpath(<span class="string">"//*[@class='if']"</span>)  </span><br><span class="line"><span class="comment">#切换到该frame  </span></span><br><span class="line">driver.switch_to.frame(el)  </span><br><span class="line"><span class="comment">#对iframe页面操作  </span></span><br><span class="line">driver.find_element_by_css_selector(<span class="string">"#kw"</span>).send_keys(<span class="string">"iframe"</span>)  </span><br><span class="line">driver.find_element_by_css_selector(<span class="string">"#su"</span>).click()  </span><br><span class="line">print(ctime())  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#跳出当前一级表单  </span></span><br><span class="line">driver.switch_to.parent_frame ()  </span><br><span class="line"><span class="comment">#切换到最外层的页面  </span></span><br><span class="line">driver.switch_to.default_content()</span><br></pre></td></tr></table></figure>

<h2 id="多窗口切换"><a href="#多窗口切换" class="headerlink" title="多窗口切换"></a>多窗口切换</h2><p>在页面操作过程中有时候点击某个链接会弹出新的窗口，</p>
<p>webdriver的switch_to.window()方法</p>
<p>，可以实现在不同窗口之间的切换。</p>
<p>实例：</p>
<p>打开百度首页，打开新的窗口注册窗口，在返回百度首页窗口。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>)  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">driver.maximize_window()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#获得百度搜索窗口句柄  </span></span><br><span class="line">search_windows = driver.current_window_handle  </span><br><span class="line">  </span><br><span class="line">driver.find_element_by_link_text(<span class="string">"登录"</span>).click()  </span><br><span class="line">driver.find_element_by_link_text(<span class="string">"立即注册"</span>).click()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#获得当前所有打开窗口的句柄，这里一共就两个句柄。  </span></span><br><span class="line">all_handles = driver.window_handles  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#进入注册窗口  </span></span><br><span class="line"><span class="keyword">for</span> handle <span class="keyword">in</span> all_handles:  </span><br><span class="line">    <span class="keyword">if</span> handle != search_windows: <span class="comment">#不是百度句柄，就是注册句柄了。  </span></span><br><span class="line">        driver.switch_to.window(handle)  </span><br><span class="line">        print(<span class="string">"现在是注册窗口！"</span>)  </span><br><span class="line">        <span class="comment">#获取当前页面的title  </span></span><br><span class="line">        title = driver.title  </span><br><span class="line">        print(title)  </span><br><span class="line">        <span class="keyword">pass</span>  </span><br><span class="line">        <span class="comment">#获取当前注册页面的URL  </span></span><br><span class="line">        url = driver.current_url  </span><br><span class="line">        print(url)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#回到搜索窗口  </span></span><br><span class="line"><span class="keyword">for</span> handle <span class="keyword">in</span> all_handles:  </span><br><span class="line">    <span class="keyword">if</span> handle ==search_windows: <span class="comment">#百度句柄了  </span></span><br><span class="line">        driver.switch_to.window(handle)  </span><br><span class="line">        print(<span class="string">"现在是搜索窗口！"</span>)  </span><br><span class="line">          </span><br><span class="line">        <span class="comment">#关闭百度登录框  </span></span><br><span class="line">        driver.find_element_by_xpath(<span class="string">".//*[@id='TANGRAM__PSP_2__closeBtn']"</span>).click()  </span><br><span class="line">          </span><br><span class="line">        title = driver.title  </span><br><span class="line">        print(title)  </span><br><span class="line">        <span class="keyword">pass</span>  </span><br><span class="line">        url = driver.current_url  </span><br><span class="line">        print(url)  </span><br><span class="line">        <span class="comment">#百度搜索  </span></span><br><span class="line">        driver.find_element_by_id(<span class="string">"kw"</span>).send_keys(<span class="string">"python"</span>)  </span><br><span class="line">        driver.find_element_by_id(<span class="string">"su"</span>).click()  </span><br><span class="line">        sleep(<span class="number">2</span>)  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>webdriver新的属性和方法：</p>
<ul>
<li>current_window_handle:获取当前窗口句柄</li>
<li>Window_handles:获取所有窗口的句柄</li>
<li>switch_to.window():切换到相应的窗口。用于不同窗口的切换；switch_to.frame()用于不同表单的切换。</li>
</ul>
<h2 id="警告框处理"><a href="#警告框处理" class="headerlink" title="警告框处理"></a>警告框处理</h2><p>webdriver中处理js所生成的alert、confirm、prompt警告框：（怎么区分是不是警告框的一种方法：利用firebug的“点击查看元素”，是不能定位到警告框的元素位置的，定位到的就不是警告框了，可以通过一般的方式操作该页面的元素，这里要理解警告是怎么产生的，一般是js脚本<code>&lt;script&gt;docum.write(alert())&lt;/script&gt;</code>）</p>
<p>使用switch_to_alert()方法定位到alert、confirm、prompt，然后使用text、accept、dismiss、send_keys等方法进行操作。</p>
<ul>
<li>text：返回alert、confirm、prompt中的文字信息；</li>
<li>accept()：接受现有警告框；</li>
<li>dismiss()：解散现有警告框；</li>
<li>send_keys(keysToSend)：发送文本到警告框。keyToSend：将文本发送到警告框</li>
</ul>
<p>操作实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *  </span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line">driver.maximize_window()  </span><br><span class="line"><span class="comment">#鼠标悬停  </span></span><br><span class="line">el = driver.find_element_by_link_text(<span class="string">"设置"</span>)  </span><br><span class="line">ActionChains(driver).move_to_element(el).perform()  </span><br><span class="line"><span class="comment">#打开搜索设置  </span></span><br><span class="line">driver.find_element_by_link_text(<span class="string">"搜索设置"</span>).click()  </span><br><span class="line"><span class="comment">#点击恢复默认  </span></span><br><span class="line">driver.find_element_by_link_text(<span class="string">"恢复默认"</span>).click()  </span><br><span class="line">sleep(<span class="number">2</span>)  </span><br><span class="line"><span class="comment">#返回警告框中的文本信息  </span></span><br><span class="line">text = driver.switch_to_alert().text  </span><br><span class="line">print(text)  </span><br><span class="line"><span class="comment">#接受现有警告框  </span></span><br><span class="line">driver.switch_to_alert().accept()  </span><br><span class="line">  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<h2 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h2><p>file.html</p>
<p>通过input标签实现的上传功能</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>file test!<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color:blue;text-align:left;font-size:30px;"</span>&gt;</span>请上传一个文件：<span class="tag">&lt;/<span class="name">p</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">id</span>=<span class="string">"myform"</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">accept</span>=<span class="string">""</span> <span class="attr">multiple</span>=<span class="string">"multiple"</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>实例：通过input标签实现上传功能的可以通过send_keys(“文件地址”)上传</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://192.168.225.137/html5/file.html"</span>)  </span><br><span class="line"><span class="comment">#通过send_keys()上传  </span></span><br><span class="line">driver.find_element_by_css_selector(<span class="string">"[type='file']"</span>).send_keys(<span class="string">"C:\\Users\\Administrator\\Desktop\\html5.txt"</span>)</span><br></pre></td></tr></table></figure>

<img src="/2018/04/30/1505WebDriver-定位元素的8种方式/20161215224623007.jpg">

<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><p>实例：下载一个文件（此实例只适合Firefox浏览器）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#为了能够让Firefox()实现下载，需要对FirefoxPile()进行设置  </span></span><br><span class="line">fp = webdriver.FirefoxProfile()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#browser.download.folderList设置为0，下载到浏览器默认的路径；设置为2则可以设置下载路径  </span></span><br><span class="line">fp.set_preference(<span class="string">'browser.download.folderList'</span>,<span class="number">2</span>)  </span><br><span class="line"><span class="comment">#browser.download.manager.showWhenStarting设为false不显示开始，设为true显示开始  </span></span><br><span class="line">fp.set_preference(<span class="string">'browser.download.manager.showWhenStarting'</span>,<span class="literal">False</span>)  </span><br><span class="line"><span class="comment">#browser.download.dir用于指定下载文件的目录，os.getcwd()当前目录  </span></span><br><span class="line">fp.set_preference(<span class="string">'browser.download.dir'</span>,os.getcwd())  </span><br><span class="line"><span class="comment">#browser.helperApps.neverAsk.saveToDisk指定下载页面的Content-type值，“application/octet-stream”是文件的类型  </span></span><br><span class="line">fp.set_preference(<span class="string">'browser.helperApps.neverAsk.saveToDisk'</span>,  </span><br><span class="line">                   <span class="string">'application/octet-stream'</span>)  </span><br><span class="line"><span class="comment">#将所有设置的信息在调用webdriver的Firefox时作为参数传递给浏览器，Firefox浏览器就是根据折现设置信息将文件下载到设定的脚本目录下。  </span></span><br><span class="line">driver = webdriver.Firefox(firefox_profile = fp)  </span><br><span class="line">driver.get(<span class="string">'https://pypi.python.org/pypi/selenium'</span>)  </span><br><span class="line">driver.find_element_by_partial_link_text(<span class="string">"selenium-3.0"</span>).click()  </span><br><span class="line">time.sleep(<span class="number">30</span>)  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>为了能够让Firefox()实现下载，需要对FirefoxPile()进行设置：</p>
<ul>
<li>browser.download.folderList设置为0，下载到浏览器默认的路径；设置为2则可以设置下载路径</li>
<li>browser.download.manager.showWhenStarting设为false不显示开始，设为true显示开始</li>
<li>browser.download.dir用于指定下载文件的目录，os.getcwd()当前目录</li>
<li>browser.helperApps.neverAsk.saveToDisk指定下载页面的Content-type值，“application/octet-stream”是文件的类型</li>
</ul>
<p>HTTP Content-type常用的对照表：<a href="http://tool.oschina[.NET](http://lib.csdn.net/base/dotnet)/commons" target="_blank" rel="noopener">http://tool.oschina[.NET](http://lib.csdn.net/base/dotnet)/commons</a></p>
<h2 id="操作cookie"><a href="#操作cookie" class="headerlink" title="操作cookie"></a>操作cookie</h2><p>有时候我们需要验证浏览器中cookie是否正确。webdriver提供了操作cookie的相关方法，可以读取、添加、删除cookie信息。</p>
<p>webdriver操作cookie的方法：</p>
<ul>
<li>get_cookies()：获取所有的cookie信息</li>
<li>get_cookie(name)：返回字典的key为name的cookie信息</li>
<li>add_cookie(cookie_dict) ：添加cookie。cookie_dict值字典对象，必须有name和value值</li>
<li>delete_cookie(name,optionString)：删除cookie信息。name是要删除的cookie名称，optionString是该cookie的选项，目前支持的选项包括“路径”，“域”</li>
<li>delete_all_cookies()：删除所有的cookie信息</li>
</ul>
<p>get_cookie()实例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.hao123.com/"</span>)  </span><br><span class="line"><span class="comment">#获取所有cookies  </span></span><br><span class="line">cookies = driver.get_cookies()  </span><br><span class="line">print(cookies)  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>添加cookie实例：add_cookie()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://www.baidu.com/"</span>)  </span><br><span class="line"><span class="comment">#添加cookie，字典形式且必须有name、value值  </span></span><br><span class="line">driver.add_cookie(&#123;<span class="string">"name"</span>:<span class="string">"user"</span>,<span class="string">"value"</span>:<span class="string">"tester"</span>&#125;)  </span><br><span class="line"><span class="comment">#遍历所有的cookies中的name、value并打印出来，就会显示添加的信息了  </span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> driver.get_cookies():  </span><br><span class="line">    print(<span class="string">"%s =&gt; %s"</span>%(i[<span class="string">'name'</span>],i[<span class="string">'value'</span>]))  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<h2 id="调用JavaScript"><a href="#调用JavaScript" class="headerlink" title="调用JavaScript"></a>调用JavaScript</h2><p>webdriver对与浏览器的滚动条没有提供相应的操作方法，可以接着<a href="http://lib.csdn.net/base/javascript" target="_blank" rel="noopener">JavaScript</a>来控制浏览器的滚动条。webdriver提供了execute_script()方法来执行JavaScript代码。</p>
<p>调整浏览器的滚动条位置的JavaScript方法：</p>
<p>window.scrollTo(水平位置,垂直位置);</p>
<p>水平位置是指水平的左间距；</p>
<p>垂直位置是指垂直的上边距；</p>
<p>实例：操作百度搜结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):  </span><br><span class="line">    <span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line">    <span class="keyword">from</span> time <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">    driver = webdriver.Firefox()  </span><br><span class="line">    driver.get(<span class="string">r'http://www.baidu.com/'</span>)  </span><br><span class="line">    driver.set_window_size(<span class="number">600</span>,<span class="number">600</span>)  </span><br><span class="line">    driver.find_element_by_css_selector(<span class="string">'#kw'</span>).clear()  </span><br><span class="line">    driver.find_element_by_css_selector(<span class="string">'#kw'</span>).send_keys(<span class="string">"python接口测试"</span>)  </span><br><span class="line">    driver.find_element_by_xpath(<span class="string">"//*[@id='su']"</span>).click()  </span><br><span class="line">    sleep(<span class="number">2</span>)  </span><br><span class="line">    <span class="comment">#通过JavaScript设置浏览器窗口的滚动条位置  </span></span><br><span class="line">    js = <span class="string">"window.scrollTo(100,300);"</span>  </span><br><span class="line">    driver.execute_script(js)  </span><br><span class="line">    sleep(<span class="number">3</span>)  </span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>

<p>另外JavaScript的作用还可以想textarea多行文本框输入内容：</p>
<p>多行文本.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE HTML&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>多行文本 test!!<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">h3</span>&gt;</span>请输入你的建议：<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">name</span>=<span class="string">"1"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"suggest"</span> <span class="attr">cols</span>=<span class="string">"50"</span> <span class="attr">rows</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">id</span>=<span class="string">"3"</span> <span class="attr">value</span>=<span class="string">"提交叻"</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2018/04/30/1505WebDriver-定位元素的8种方式/20161218222446476.jpg">

<p>操作textarea文本框</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r"http://192.168.225.137/html5/textarea.html"</span>)  </span><br><span class="line">driver.maximize_window()  </span><br><span class="line"><span class="comment">#首先text定义要输入的内容  </span></span><br><span class="line">text = <span class="string">"我的建议是，哈哈哈哈哈哈哈哈"</span>  </span><br><span class="line"><span class="comment">#然后将text与JavaScript代码通过“+”拼接，这样是使输入的内容变得可以自定义  </span></span><br><span class="line">js = <span class="string">"var sum=document.get_element_by_name('suggest');sum.value='"</span> + text + <span class="string">"';"</span>  </span><br><span class="line"><span class="comment">#通过execute_script()执行js代码  </span></span><br><span class="line">driver.execute_script(js)  </span><br><span class="line">  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='3']"</span>).click()  </span><br><span class="line">sleep(<span class="number">5</span>)  </span><br><span class="line">  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<h2 id="窗口截图"><a href="#窗口截图" class="headerlink" title="窗口截图"></a>窗口截图</h2><p>webdriver提供了截图函数<strong>get_screenshot_as_file(‘保存文件的路径’)</strong>来截取当前窗口。</p>
<p>实例1：截取百度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r'http://www.baidu.com/'</span>)  </span><br><span class="line">driver.maximize_window()  </span><br><span class="line">driver.find_element_by_css_selector(<span class="string">'#kw'</span>).send_keys(<span class="string">"selenium"</span>)  </span><br><span class="line">driver.find_element_by_id(<span class="string">'su'</span>).click()  </span><br><span class="line">time.sleep(<span class="number">3</span>)  </span><br><span class="line"><span class="comment">#截取当前窗口，并将图片保存到指定位置  </span></span><br><span class="line">driver.get_screenshot_as_file(<span class="string">'E:\\screenshot\\baidu.jpg'</span>)  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>实例2：截取126邮箱</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">import</span> time  </span><br><span class="line">  </span><br><span class="line">driver = webdriver.Firefox()  </span><br><span class="line">driver.get(<span class="string">r'http://www.126.com/'</span>)  </span><br><span class="line">driver.maximize_window()  </span><br><span class="line">driver.implicitly_wait(<span class="number">5</span>)  </span><br><span class="line">url = driver.current_url  </span><br><span class="line">print(url)  </span><br><span class="line">title = driver.title  </span><br><span class="line">print(title)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#使用截图函数，截取当前页面  </span></span><br><span class="line">driver.get_screenshot_as_file(<span class="string">'E:\\screenshot\\login.jpg'</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#登录126邮箱  </span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='login-form']/div/div/div[2]/input"</span>).clear()  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@id='login-form']/div/div/div[2]/input"</span>).send_keys(<span class="string">'XXX—you'</span>)  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@type='password']"</span>).clear()  </span><br><span class="line">driver.find_element_by_xpath(<span class="string">"//*[@type='password']"</span>).send_keys(<span class="string">'yuexxx.'</span>)  </span><br><span class="line">driver.find_element_by_id(<span class="string">'dologin'</span>).click()  </span><br><span class="line">time.sleep(<span class="number">3</span>)  </span><br><span class="line">title = driver.title  </span><br><span class="line">print(title)  </span><br><span class="line">url = driver.current_url  </span><br><span class="line">print(url)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#截取登录后的页面  </span></span><br><span class="line">driver.get_screenshot_as_file(<span class="string">"E:\\screenshot\\afterlogin"</span>)  </span><br><span class="line">time.sleep(<span class="number">3</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#退出邮箱  </span></span><br><span class="line">driver.find_element_by_link_text(<span class="string">"退出"</span>).click()  </span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure>

<p>打开E盘screeshot目录就看到截取的JPG图片了！</p>
<p>在做UI自动化<a href="http://lib.csdn.net/base/softwaretest" target="_blank" rel="noopener">测试</a>时，可以把该截图函数：get_screenshot_as_file()封装成单独一个模块，需要截取的时直接使用该方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''''' </span></span><br><span class="line"><span class="string">定义截图函数。 </span></span><br><span class="line"><span class="string">创建截图函数insert_img(),为了保持自动化项目的可移植性，采用相对 </span></span><br><span class="line"><span class="string">路径的方式将测试截图保存到.\report\image\目录中。 </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#截图函数  </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">insert_img</span><span class="params">(driver,file_name)</span>:</span>  </span><br><span class="line">    <span class="comment">#获取当前运行脚本的路径保存到base_dir里面  </span></span><br><span class="line">    base_dir = os.path.dirname(os.path.dirname(__file__))  </span><br><span class="line">    <span class="comment">#把获取到的路径转为字符串  </span></span><br><span class="line">    base_dir = str(base_dir)  </span><br><span class="line">    <span class="comment">#字符串函数replace()把路径中的“\\”变成“/”  </span></span><br><span class="line">    base_dir = base_dir.replace(<span class="string">'\\'</span>,<span class="string">'/'</span>)  </span><br><span class="line">    <span class="comment">#利用split()方法把字符串以“/test_case/”分割为两部分，split分割字符串后保存为列表，把左边的保存到base列表中  </span></span><br><span class="line">    base = base_dir.split(<span class="string">'/test_case'</span>)[<span class="number">0</span>]  </span><br><span class="line">    <span class="comment">#利用字符串拼接重新组合文件路径。get_screenshot_as_file(文件路径+截取到的文件名)  </span></span><br><span class="line">    file_path = base +<span class="string">"/report/image/"</span> + file_name  </span><br><span class="line">    driver.get_screenshot_as_file(file_path)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:  </span><br><span class="line">    driver = webdriver.Firefox()  </span><br><span class="line">    driver.get(<span class="string">"https://www.126.com/"</span>)  </span><br><span class="line">    <span class="comment">#调用截图函数  </span></span><br><span class="line">    insert_img(driver,<span class="string">"126.jpg"</span>)  </span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>

<h2 id="验证码处理"><a href="#验证码处理" class="headerlink" title="验证码处理"></a>验证码处理</h2><p>对于有些登录系统是需要验证码的，怎么处理呢？</p>
<p><strong>去掉验证码</strong></p>
<p>   但如果自动化脚本是在正式环境中测试，这种做法就会给系统带来一定的风险。</p>
<p><strong>设置万能的验证码</strong></p>
<p>只要测试时输入一个万能验证码，程序就认为验证通过，否则就判断用户输入的验证码是否正确。设计万能验证码的方式只需要对用户的输入信息多加一个逻辑判断，如下：</p>
<p>number.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#生成1000到9999之间一个随机数  </span></span><br><span class="line">verify = randint(<span class="number">1000</span>,<span class="number">9999</span>)  </span><br><span class="line">print(<span class="string">u"生成的随机数是：%s"</span>%verify)  </span><br><span class="line">  </span><br><span class="line">number =input(<span class="string">"请输入一个验证码："</span>)  </span><br><span class="line">number = int(number)    <span class="comment">#把number转为int和随机数类型一致  </span></span><br><span class="line">print(number)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> number == verify:    <span class="comment">#number和verify类型要一致才有可比性  </span></span><br><span class="line">    print(<span class="string">"验证码正确！"</span>)  </span><br><span class="line"><span class="keyword">elif</span> number == <span class="number">1234</span>:  </span><br><span class="line">    print(<span class="string">"验证吗正确！"</span>)  </span><br><span class="line"><span class="keyword">else</span>:  </span><br><span class="line">    print(<span class="string">"验证码错误！！！"</span>)</span><br></pre></td></tr></table></figure>

<p>这个程序分别输入正确的验证码、万能验证码、错误验证码。</p>
<p><strong>记录cookie</strong></p>
<p>通过向浏览器中添加cookie可以要过登录的验证码。</p>
<h1 id="基本操作函数"><a href="#基本操作函数" class="headerlink" title="基本操作函数"></a>基本操作函数</h1><h2 id="driver-标签语句-click"><a href="#driver-标签语句-click" class="headerlink" title="driver.标签语句.click()"></a>driver.标签语句.click()</h2><p>执行一次点击事件，就是点一下当前的标签</p>
<h2 id="driver-标签语句-send-keys-‘’"><a href="#driver-标签语句-send-keys-‘’" class="headerlink" title="driver.标签语句.send_keys(‘’)"></a>driver.标签语句.send_keys(‘’)</h2><p>向当前标签输入一段内容为字符串</p>
<h2 id="driver-标签语句-size"><a href="#driver-标签语句-size" class="headerlink" title="driver.标签语句.size()"></a>driver.标签语句.size()</h2><p>返回元素尺寸</p>
<h2 id="driver-标签语句-text"><a href="#driver-标签语句-text" class="headerlink" title="driver.标签语句.text()"></a>driver.标签语句.text()</h2><p>返回元素文本</p>
<h2 id="driver-标签语句-get-attribute"><a href="#driver-标签语句-get-attribute" class="headerlink" title="driver.标签语句.get_attribute()"></a>driver.标签语句.get_attribute()</h2><p>方法获取属性值</p>
<h2 id="driver-标签语句-is-displayed"><a href="#driver-标签语句-is-displayed" class="headerlink" title="driver.标签语句.is_displayed()"></a>driver.标签语句.is_displayed()</h2><p>返回该元素是否可见</p>
<h2 id="driver-back"><a href="#driver-back" class="headerlink" title="driver.back()"></a>driver.back()</h2><p>返回上一个页面 </p>
<h2 id="driver-forward"><a href="#driver-forward" class="headerlink" title="driver.forward()"></a>driver.forward()</h2><p>前进前一个页面</p>
<h2 id="driver-refresh"><a href="#driver-refresh" class="headerlink" title="driver.refresh()"></a>driver.refresh()</h2><p>刷新当前页面</p>
<h2 id="driver-quit"><a href="#driver-quit" class="headerlink" title="driver.quit()"></a>driver.quit()</h2><p>退出浏览器，表示结束</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Wenng</span>
                    </p>
                
                
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY<strong>?</strong></strong></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/爬虫/"># 爬虫</a>
                    
                        <a href="/tags/Python/"># Python</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2018/05/02/Vue原理/">Vue原理 - 主要Render</a>
            
            
            <a class="next" rel="next" href="/2018/02/25/Python学习到什么程度可以去面试？/">Python学习到什么程度可以去面试？</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Wenng | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
